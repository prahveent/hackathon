<div class="checkout-container">
  <!-- Navigation Header -->
  <div class="nav-header">
    <div class="nav-content">
      <h1>SmartCart</h1>
      <div class="nav-links">
        <button class="nav-btn" (click)="backToCart()" *ngIf="!orderPlaced">Back to Cart</button>
        <button class="nav-btn" (click)="continueShopping()">Continue Shopping</button>
      </div>
    </div>
  </div>

  <div class="checkout-content" *ngIf="!orderPlaced">
    <!-- Progress Indicator -->
    <div class="progress-bar">
      <div class="progress-steps">
        <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
          <div class="step-number">1</div>
          <div class="step-label">Shipping</div>
        </div>
        <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
          <div class="step-number">2</div>
          <div class="step-label">Review</div>
        </div>
        <div class="step" [class.active]="currentStep >= 3">
          <div class="step-number">3</div>
          <div class="step-label">Confirmation</div>
        </div>
      </div>
    </div>

    <div class="checkout-main">
      <!-- Step 1: Customer Information -->
      <div class="checkout-step" *ngIf="currentStep === 1">
        <h2>Shipping Information</h2>
        
        <form [formGroup]="customerForm" class="customer-form">
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">First Name *</label>
              <input 
                type="text" 
                id="firstName" 
                formControlName="firstName"
                [class.error]="getFieldError('firstName')"
              />
              <div class="error-message" *ngIf="getFieldError('firstName')">
                {{ getFieldError('firstName') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="lastName">Last Name *</label>
              <input 
                type="text" 
                id="lastName" 
                formControlName="lastName"
                [class.error]="getFieldError('lastName')"
              />
              <div class="error-message" *ngIf="getFieldError('lastName')">
                {{ getFieldError('lastName') }}
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="email">Email Address *</label>
              <input 
                type="email" 
                id="email" 
                formControlName="email"
                [class.error]="getFieldError('email')"
              />
              <div class="error-message" *ngIf="getFieldError('email')">
                {{ getFieldError('email') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="phone">Phone Number *</label>
              <input 
                type="tel" 
                id="phone" 
                formControlName="phone"
                placeholder="1234567890"
                [class.error]="getFieldError('phone')"
              />
              <div class="error-message" *ngIf="getFieldError('phone')">
                {{ getFieldError('phone') }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="street">Street Address *</label>
            <input 
              type="text" 
              id="street" 
              formControlName="street"
              [class.error]="getFieldError('street')"
            />
            <div class="error-message" *ngIf="getFieldError('street')">
              {{ getFieldError('street') }}
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="city">City *</label>
              <input 
                type="text" 
                id="city" 
                formControlName="city"
                [class.error]="getFieldError('city')"
              />
              <div class="error-message" *ngIf="getFieldError('city')">
                {{ getFieldError('city') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="state">State *</label>
              <input 
                type="text" 
                id="state" 
                formControlName="state"
                [class.error]="getFieldError('state')"
              />
              <div class="error-message" *ngIf="getFieldError('state')">
                {{ getFieldError('state') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="zipCode">ZIP Code *</label>
              <input 
                type="text" 
                id="zipCode" 
                formControlName="zipCode"
                placeholder="12345"
                [class.error]="getFieldError('zipCode')"
              />
              <div class="error-message" *ngIf="getFieldError('zipCode')">
                {{ getFieldError('zipCode') }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="country">Country *</label>
            <select id="country" formControlName="country">
              <option value="United States">United States</option>
              <option value="Canada">Canada</option>
            </select>
          </div>
        </form>

        <div class="step-actions">
          <button class="btn btn-primary" (click)="nextStep()" [disabled]="!customerForm.valid">
            Continue to Review
          </button>
        </div>
      </div>

      <!-- Step 2: Order Review -->
      <div class="checkout-step" *ngIf="currentStep === 2">
        <h2>Review Your Order</h2>
        
        <!-- Order Summary -->
        <div class="order-summary">
          <h3>Order Items</h3>
          <div class="order-items">
            <div class="order-item" *ngFor="let item of cart.items">
              <img 
                [src]="item.productImage || 'https://picsum.photos/60/60?random=999'" 
                [alt]="item.productName"
              />
              <div class="item-details">
                <h4>{{ item.productName }}</h4>
                <p>Quantity: {{ item.quantity }}</p>
                <p class="item-price">{{ formatPrice(item.price) }} each</p>
              </div>
              <div class="item-total">
                {{ formatPrice(item.price * item.quantity) }}
              </div>
            </div>
          </div>
        </div>

        <!-- Shipping Information -->
        <div class="shipping-info">
          <h3>Shipping Address</h3>
          <div class="address-display">
            <p>{{ customerForm.value.firstName }} {{ customerForm.value.lastName }}</p>
            <p>{{ customerForm.value.street }}</p>
            <p>{{ customerForm.value.city }}, {{ customerForm.value.state }} {{ customerForm.value.zipCode }}</p>
            <p>{{ customerForm.value.country }}</p>
            <p>{{ customerForm.value.email }}</p>
            <p>{{ customerForm.value.phone }}</p>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn btn-secondary" (click)="previousStep()">
            Back to Shipping
          </button>
          <button class="btn btn-primary" (click)="placeOrder()">
            Place Order
          </button>
        </div>
      </div>
    </div>

    <!-- Order Summary Sidebar -->
    <div class="order-summary-sidebar">
      <h3>Order Summary</h3>
      
      <div class="summary-line">
        <span>Items ({{ cart.totalItems }}):</span>
        <span>{{ formatPrice(cart.subtotal) }}</span>
      </div>
      
      <div class="summary-line">
        <span>Shipping:</span>
        <span>{{ shippingCost === 0 ? 'FREE' : formatPrice(shippingCost) }}</span>
      </div>
      
      <div class="summary-line total">
        <span>Total:</span>
        <span>{{ formatPrice(getTotalWithShipping()) }}</span>
      </div>
      
      <div class="security-info">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          <circle cx="12" cy="16" r="1"/>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        </svg>
        <span>Secure checkout</span>
      </div>
    </div>
  </div>

  <!-- Order Confirmation -->
  <div class="order-confirmation" *ngIf="orderPlaced && placedOrder">
    <div class="confirmation-content">
      <div class="success-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22,4 12,14.01 9,11.01"/>
        </svg>
      </div>
      
      <h2>Order Confirmed!</h2>
      <p class="confirmation-message">
        Thank you for your order! We've received your order and will begin processing it shortly.
      </p>
      
      <div class="order-details">
        <div class="detail-row">
          <span>Order Number:</span>
          <span class="order-number">{{ placedOrder.orderNumber }}</span>
        </div>
        
        <div class="detail-row">
          <span>Total:</span>
          <span>{{ formatPrice(placedOrder.total) }}</span>
        </div>
        
        <div class="detail-row">
          <span>Estimated Delivery:</span>
          <span>{{ placedOrder.estimatedDelivery | date:'mediumDate' }}</span>
        </div>
      </div>
      
      <div class="confirmation-actions">
        <button class="btn btn-primary" (click)="continueShopping()">
          Continue Shopping
        </button>
      </div>
    </div>
  </div>
</div> 